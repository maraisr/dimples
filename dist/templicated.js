"use strict";function has(e,t){return e?Object.prototype.hasOwnProperty.call(e,t):!1}var babelHelpers={};babelHelpers.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},babelHelpers.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var jade=require("jade"),fs$1=require("graceful-fs"),Views=function(){function e(t){babelHelpers.classCallCheck(this,e),this.config=t,this.views=this.init()}return babelHelpers.createClass(e,[{key:"init",value:function(){var e=this;return fs$1.readdirSync(this.config.views).map(function(t){return new View(t,e.config)})}},{key:"find",value:function(e){return this.views.filter(function(t){return t.name==e}).pop()}}]),e}(),View=function(){function e(t,n){babelHelpers.classCallCheck(this,e),this.path=t,this.compiled=jade.compile(fs$1.readFileSync(n.views+this.path,"utf-8"))(),this.name=this.path.replace(/\.jade/,"").trim()}return babelHelpers.createClass(e,[{key:"mangle",get:function(){var e=0,t=void 0,n=void 0,i=void 0;if(0===this.name.length)return e;for(t=0,i=this.name.length;i>t;t++)n=this.name.charCodeAt(t),e=(e<<5)-e+n,e|=0;return Math.abs(e)}}]),e}(),fs=require("graceful-fs"),Templicated=function(){function e(t,n){if(babelHelpers.classCallCheck(this,e),this.source=t instanceof Buffer?t.toString("utf-8"):t,void 0==this.source||""==this.source)throw new ReferenceError("Templicated: No source passed.");if(this.source=this.source.trim(),this.config=n,!has(this.config,"views"))throw new ReferenceError("Templicated: No views folder defined.");this.views=new Views(this.config)}return babelHelpers.createClass(e,[{key:"compile",value:function(){for(var e=/['"]@tpl\.(.+)['"]/gm,t=void 0,n=new Array;null!==(t=e.exec(this.source));)t.index===e.lastIndex&&e.lastIndex++,t[1]&&n.push(this.views.find(t[1]));return this.sourceAugment(n)}},{key:"sourceAugment",value:function(e){var t=this,n=function(){return"\nvar $templicated = (function() {\n	function Templicated(tpls) {\n		this.tpls = tpls;\n	}\n\n	Templicated.prototype['get'] = function(which) {\n		return this.tpls[which];\n	}\n\n	return new Templicated("+JSON.stringify(e.reduce(function(e,t){return e[t.mangle]=t.compiled,e},{}))+");\n})();\n			"}().toString();return e.forEach(function(e){t.source=t.source.replace(new RegExp("['\"]@tpl\\."+e.name+"['\"]","g"),"$templicated.get('"+e.mangle+"')")}),this.source=n+this.source,new Buffer(this.source)}},{key:"code",get:function(){return this.compile().toString()}}]),e}();exports.Templicated=Templicated;